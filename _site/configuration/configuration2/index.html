<!doctype html>




<!--[if IE 9]><html class="lt-ie10" lang="en" > <![endif]-->
<html class="no-js" lang="en" data-useragent="Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)">   
  
  
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <title>ES Type Mapping</title>
    

    
    <meta name="description" content="Gives a base template for the mapping to used for the related item documents when stored in the Elasticsearch cluster"/>
    
    
    <meta name="author" content="Dominic Tootell" />
    <meta name="copyright" content="relate it (c) 2013-2014" />
    <link rel="shortcut icon" href="/favicon.ico" />

	<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="/stylesheets/foundation.css" />
    <script src="/javascripts/vendor/modernizr.js"></script>
</head>


  <body>
    

<!-- Nav Bar -->

  <header class="inner">

	<nav>	  
	  <div class="row">	  	
	    <div class="large-12 columns">	      
	      <div class="nav-bar right" style="padding-top: 30px">
	       <ul class="button-group">
	         <li><a href='/index.html' class="radius small button">Home</a></li>	         
	         <li><a href='/indexing/index.html' class="radius small button">Indexing</a><br/></li>
	         <li><a href='/searching/index.html' class="radius small button">Searching</a><br/></li>							 
	         <li><a href='/configuration/index.html' class="radius small button">Configuration</a></li>
	         <li><a href='/blog/index.html' class="radius small button">Blog</a></li>
	         <li><a href='/downloads.html'  class="radius small button">Downloads</a></li>         
	        </ul>
	      </div>
	      <h1><a href='https://github.com/tootedom/related'><img src="/images/relateitlogo.png"></a></h1>
	      <hr />
	    </div>
	  </div>
	</nav>	
</header>


  <!-- End Nav -->
  

  <div class="off-canvas-wrap">
  <div class="inner-wrap">

<nav class="tab-bar show-for-small">
  <a class="left-off-canvas-toggle menu-icon">
    <span></span>
  </a>
</nav>

<aside class="left-off-canvas-menu">

  <div class="sidebar-offcanvas">
          <h5>Documentation:</h5>          
          <nav>
            <ul class="off-canvas-list">
              <li class="heading">Indexing</li>
              
              
                
              
              

 

	<li><a href="/indexing/indexing1" data-search>Overview</a></li>


 

	<li><a href="/indexing/indexing2" data-search>Dates</a></li>


 

	<li><a href="/indexing/indexing3" data-search>Document Format</a></li>


 

	<li><a href="/indexing/indexing4" data-search>Properties</a></li>


 

	<li><a href="/indexing/indexing5" data-search>Logging</a></li>


 

	<li><a href="/indexing/indexing6" data-search>Document Info</a></li>


              <li class="divider"></li>
              <li class="heading">Searching</li>
              
              
                
              
              

 

	<li><a href="/searching/searching1" data-search>Overview</a></li>


 

	<li><a href="/searching/searching2" data-search>Filters</a></li>


 

	<li><a href="/searching/searching3" data-search>Logging</a></li>


 

	<li><a href="/searching/searching4" data-search>Indexes</a></li>


 

	<li><a href="/searching/searching5" data-search>Aliases</a></li>


              <li class="divider"></li>
              <li class="heading">Configuration</li>
              
              
                
              
              

 

	
	<li><a href="/configuration/configuration1" data-search>ES Connections</a></li>
	


 

	
	<li><a href="/configuration/configuration2" data-search class="active">ES Type Mapping</a></li>
	


 

	
	<li><a href="/configuration/configuration3" data-search>ES Configuration</a></li>
	


 

	
	<li><a href="/configuration/configuration4" data-search>Webapp JVM</a></li>
	


 

	
	<li><a href="/configuration/configuration5" data-search>App Config</a></li>
	


 

	
	<li><a href="/configuration/configuration6" data-search>Tomcat</a></li>
	


 

	
	<li><a href="/configuration/configuration7" data-search>Diagrams</a></li>
	


 

	
	<li><a href="/configuration/configuration8" data-search>Provisioning</a></li>
	


            </ul>
          </nav>
        </div> 

 
</aside>

<a class="exit-off-canvas" href="#"></a>


  <!-- Main Page Content and Sidebar -->

  <div class="row">
        <div class="large-3 medium-4 columns">
      <div class="hide-for-small">
        <div class="sidebar">
          <h5>Documentation:</h5>          
          <nav>
            <ul class="side-nav">
              <li class="heading">Indexing</li>
              
              
                
              
              

 

	<li><a href="/indexing/indexing1" data-search>Overview</a></li>


 

	<li><a href="/indexing/indexing2" data-search>Dates</a></li>


 

	<li><a href="/indexing/indexing3" data-search>Document Format</a></li>


 

	<li><a href="/indexing/indexing4" data-search>Properties</a></li>


 

	<li><a href="/indexing/indexing5" data-search>Logging</a></li>


 

	<li><a href="/indexing/indexing6" data-search>Document Info</a></li>


              <li class="divider"></li>
              <li class="heading">Searching</li>
              
              
                
              
              

 

	<li><a href="/searching/searching1" data-search>Overview</a></li>


 

	<li><a href="/searching/searching2" data-search>Filters</a></li>


 

	<li><a href="/searching/searching3" data-search>Logging</a></li>


 

	<li><a href="/searching/searching4" data-search>Indexes</a></li>


 

	<li><a href="/searching/searching5" data-search>Aliases</a></li>


              <li class="divider"></li>
              <li class="heading">Configuration</li>
              
              
                
              
              

 

	
	<li><a href="/configuration/configuration1" data-search>ES Connections</a></li>
	


 

	
	<li><a href="/configuration/configuration2" data-search class="active">ES Type Mapping</a></li>
	


 

	
	<li><a href="/configuration/configuration3" data-search>ES Configuration</a></li>
	


 

	
	<li><a href="/configuration/configuration4" data-search>Webapp JVM</a></li>
	


 

	
	<li><a href="/configuration/configuration5" data-search>App Config</a></li>
	


 

	
	<li><a href="/configuration/configuration6" data-search>Tomcat</a></li>
	


 

	
	<li><a href="/configuration/configuration7" data-search>Diagrams</a></li>
	


 

	
	<li><a href="/configuration/configuration8" data-search>Provisioning</a></li>
	


            </ul>
          </nav>
        </div> 
      </div>
    </div>
    <!-- Main Blog Content -->
    <div class="large-9 medium-8 columns" role="content">
    
    <div class="magellan-container" data-magellan-expedition="fixed" style="left: auto;">
      <dl class="sub-nav">        
        
        
         
        
          <dd data-magellan-arrival="1" ><a href="/configuration/configuration1">ES Connections</a></dd>
        
        <li class="divider">|</li>
        
         
        
          <dd data-magellan-arrival="2" class="active"><a href="/configuration/configuration2">ES Type Mapping</a></dd>       
        
        <li class="divider">|</li>
        
         
        
          <dd data-magellan-arrival="3" ><a href="/configuration/configuration3">ES Configuration</a></dd>
        
        <li class="divider">|</li>
        
         
        
          <dd data-magellan-arrival="4" ><a href="/configuration/configuration4">Webapp JVM</a></dd>
        
        <li class="divider">|</li>
        
         
        
          <dd data-magellan-arrival="5" ><a href="/configuration/configuration5">App Config</a></dd>
        
        <li class="divider">|</li>
        
         
        
          <dd data-magellan-arrival="6" ><a href="/configuration/configuration6">Tomcat</a></dd>
        
        <li class="divider">|</li>
        
         
        
          <dd data-magellan-arrival="7" ><a href="/configuration/configuration7">Diagrams</a></dd>
        
        <li class="divider">|</li>
        
         
        
          <dd data-magellan-arrival="8" ><a href="/configuration/configuration8">Provisioning</a></dd>
        
        <li class="divider">|</li>
                
      </dl>
</div>      

    <h1><a href="/configuration/configuration2">ES Type Mapping</a></h1>
    <p>When the indexing and searching applications talk to elasticsearch they search for documents within the index <code>relateditems-YYYY-MM-DD</code> for the document type <code>related</code>. The defined properties require for the <code>related</code> type are that of:</p>

<ul>
<li>id</li>

<li>related-with</li>

<li>date</li>
</ul>

<p>When indexing documents in elasticsearch, if a type (i.e. “related”) does not have an associated mapping then a dynamic mapping of a document’s json properties are created by that of elasticsearch (the default behaviour of elasticsearch) Which may or may not be what is required. As a result, you should define a mapping for the type. The mapping for the related type should at minimum be the following:</p>

<pre><code>curl -XPUT http://localhost:9200/_template/relateditems -d &#39;{
    &quot;template&quot; : &quot;relateditems*&quot;,
    &quot;settings&quot; : {
        &quot;number_of_shards&quot; : 1,
        &quot;number_of_replicas&quot; : 1,
        &quot;index.refresh_interval&quot; : &quot;5s&quot;,
        &quot;index.store.compress.stored&quot; : false,
        &quot;index.query.default_field&quot; : &quot;id&quot;,
        &quot;index.routing.allocation.total_shards_per_node&quot; : 1,
        &quot;indices.memory.index_buffer_size&quot; : 30
    },
    &quot;mappings&quot; : {
        &quot;related&quot; : {
           &quot;_all&quot; : {&quot;enabled&quot; : false},
           &quot;dynamic&quot; : false,
           &quot;properties&quot; : {
              &quot;id&quot;: { &quot;type&quot;: &quot;string&quot;, &quot;index&quot;: &quot;not_analyzed&quot;, &quot;store&quot; : &quot;yes&quot; },
              &quot;related-with&quot;: { &quot;type&quot;: &quot;string&quot;, &quot;index&quot;: &quot;not_analyzed&quot;, &quot;store&quot; : &quot;yes&quot; },
              &quot;date&quot;: { &quot;type&quot;: &quot;date&quot;, &quot;index&quot;: &quot;not_analyzed&quot;, &quot;store&quot; : &quot;no&quot; }
           }
        }
    }
}&#39;</code></pre>

<p>If the related documents you are indexed are going to have more properties (i.e. channel, type, etc). You need to expand upon the mapping above to detail those properties. A guide to mapping can be found <a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/mapping-core-types.html">In the following elasticsearch documentation</a></p>

<pre><code>curl -XPUT http://localhost:9200/_template/relateditems -d &#39;{
    &quot;template&quot; : &quot;relateditems*&quot;,
    &quot;settings&quot; : {
        &quot;number_of_shards&quot; : 1,
        &quot;number_of_replicas&quot; : 1,
        &quot;index.refresh_interval&quot; : &quot;5s&quot;,
        &quot;index.store.compress.stored&quot; : false,
        &quot;index.query.default_field&quot; : &quot;id&quot;,
        &quot;index.routing.allocation.total_shards_per_node&quot; : 1,
        &quot;indices.memory.index_buffer_size&quot; : 30
    },
    &quot;mappings&quot; : {
        &quot;related&quot; : {
           &quot;_all&quot; : {&quot;enabled&quot; : false},
           &quot;dynamic&quot; : false,
           &quot;properties&quot; : {
              &quot;id&quot;: { &quot;type&quot;: &quot;string&quot;, &quot;index&quot;: &quot;not_analyzed&quot;, &quot;store&quot; : &quot;yes&quot; },
              &quot;related-with&quot;: { &quot;type&quot;: &quot;string&quot;, &quot;index&quot;: &quot;not_analyzed&quot;, &quot;store&quot; : &quot;yes&quot; },
              &quot;date&quot;: { &quot;type&quot;: &quot;date&quot;, &quot;index&quot;: &quot;not_analyzed&quot;, &quot;store&quot; : &quot;no&quot; },
              &quot;channel&quot; : {&quot;type&quot; : &quot;string&quot; , &quot;index&quot; : &quot;not_analyzed&quot;, &quot;store&quot; : &quot;no&quot; },
              &quot;site&quot; : {&quot;type&quot; : &quot;string&quot; , &quot;index&quot; : &quot;not_analyzed&quot;, &quot;store&quot; : &quot;no&quot; },
              &quot;type&quot; : {&quot;type&quot; : &quot;string&quot; , &quot;index&quot; : &quot;not_analyzed&quot;, &quot;store&quot; : &quot;no&quot; }
           }
        }
    }
}&#39;</code></pre>
<hr />
<h2 id="shardingreplicas">Sharding/Replicas</h2>

<p>As previously mentioned within the searching section, by default a new index is created in elastcisearch each day (<a href="/searching/searching4/">Searching Indexes</a>. When a search is performed, the search is made across all those indexes. In order to present the frequently related items elasticsearch facetting is used. It is recommended that only 1 shard is used, in order for acurate results to be returned for the faceting. As a new index is being created daily, (a shard is effectively a new index), the lack of sharding will not impact the system greatly. For most information regarding using more than 1 shard please see the following bug report: <a href="https://github.com/elasticsearch/elasticsearch/issues/1305">ES-1305</a>. If you wish to use more the on shard then use either the property <code>related-item.searching.default.number.of.results</code>; setting it to a larger number, or at search time specify the query parameter: <code>maxresults</code> to a large value.</p>

<p>However, be warned setting either <code>maxresults</code> or <code>related-item.searching.default.number.of.results</code>, means the search result will be larger.</p>

<p>As a result, it is advisable to only have <code>1 shard</code>. Instead you should have a least 1 or more <code>replicas</code>. Whilst having 1 or more <code>replicas</code> will slow down indexing slightly (writes have to go to more than 1 index). However, having 1 or more replicas makes sense from two aspects:</p>

<ul>
<li>A backup of the index. If one node fails; the replica living on another node can take over.</li>

<li>Searches are more performant.</li>
</ul>

<!--       <article>

        <h3><a href="#">Blog Post Title</a></h3>
        <h6>Written by <a href="#">John Smith</a> on August 12, 2012.</h6>

        <div class="row">
          <div class="large-6 columns">
            <p>Bacon ipsum dolor sit amet nulla ham qui sint exercitation eiusmod commodo, chuck duis velit. Aute in reprehenderit, dolore aliqua non est magna in labore pig pork biltong. Eiusmod swine spare ribs reprehenderit culpa.</p>
            <p>Boudin aliqua adipisicing rump corned beef. Nulla corned beef sunt ball tip, qui bresaola enim jowl. Capicola short ribs minim salami nulla nostrud pastrami.</p>
          </div>
          <div class="large-6 columns">
            <img src="http://placehold.it/400x240&text=[img]" />
          </div>
        </div>

        <p>Pork drumstick turkey fugiat. Tri-tip elit turducken pork chop in. Swine short ribs meatball irure bacon nulla pork belly cupidatat meatloaf cow. Nulla corned beef sunt ball tip, qui bresaola enim jowl. Capicola short ribs minim salami nulla nostrud pastrami. Nulla corned beef sunt ball tip, qui bresaola enim jowl. Capicola short ribs minim salami nulla nostrud pastrami.</p>

        <p>Pork drumstick turkey fugiat. Tri-tip elit turducken pork chop in. Swine short ribs meatball irure bacon nulla pork belly cupidatat meatloaf cow. Nulla corned beef sunt ball tip, qui bresaola enim jowl. Capicola short ribs minim salami nulla nostrud pastrami.</p>

      </article>

      <hr />

      <article>

        <h3><a href="#">Blog Post Title</a></h3>
        <h6>Written by <a href="#">John Smith</a> on August 12, 2012.</h6>

        <div class="row">
          <div class="large-6 columns">
            <p>Bacon ipsum dolor sit amet nulla ham qui sint exercitation eiusmod commodo, chuck duis velit. Aute in reprehenderit, dolore aliqua non est magna in labore pig pork biltong. Eiusmod swine spare ribs reprehenderit culpa.</p>
            <p>Boudin aliqua adipisicing rump corned beef. Nulla corned beef sunt ball tip, qui bresaola enim jowl. Capicola short ribs minim salami nulla nostrud pastrami.</p>
          </div>
          <div class="large-6 columns">
            <img src="http://placehold.it/400x240&text=[img]" />
          </div>
        </div>

        <p>Pork drumstick turkey fugiat. Tri-tip elit turducken pork chop in. Swine short ribs meatball irure bacon nulla pork belly cupidatat meatloaf cow. Nulla corned beef sunt ball tip, qui bresaola enim jowl. Capicola short ribs minim salami nulla nostrud pastrami. Nulla corned beef sunt ball tip, qui bresaola enim jowl. Capicola short ribs minim salami nulla nostrud pastrami.</p>

        <p>Pork drumstick turkey fugiat. Tri-tip elit turducken pork chop in. Swine short ribs meatball irure bacon nulla pork belly cupidatat meatloaf cow. Nulla corned beef sunt ball tip, qui bresaola enim jowl. Capicola short ribs minim salami nulla nostrud pastrami.</p>

      </article> -->

    </div>

    <!-- End Main Content -->


    <!-- Sidebar -->

<!--     <aside class="large-3 columns">

      <h5>Categories</h5>
      <ul class="side-nav">
        <li><a href="#">News</a></li>
        <li><a href="#">Code</a></li>
        <li><a href="#">Design</a></li>
        <li><a href="#">Fun</a></li>
        <li><a href="#">Weasels</a></li>
      </ul>

      <div class="panel">
        <h5>Featured</h5>
        <p>Pork drumstick turkey fugiat. Tri-tip elit turducken pork chop in. Swine short ribs meatball irure bacon nulla pork belly cupidatat meatloaf cow.</p>
        <a href="#">Read More &rarr;</a>
      </div>

    </aside> -->

    <!-- End Sidebar -->
  </div>

  <!-- End Main Content and Sidebar -->

      <div class="pagination-centered">
      <ul class="pagination">
      
      
      
         
        
        <li><a href="/configuration/configuration1">1</a></li>
        
      
         
        
        <li class="current"><a href="/configuration/configuration2">2</a></li>
        
      
         
        
        <li><a href="/configuration/configuration3">3</a></li>
        
      
         
        
        <li><a href="/configuration/configuration4">4</a></li>
        
      
         
        
        <li><a href="/configuration/configuration5">5</a></li>
        
      
         
        
        <li><a href="/configuration/configuration6">6</a></li>
        
      
         
        
        <li><a href="/configuration/configuration7">7</a></li>
        
      
         
        
        <li><a href="/configuration/configuration8">8</a></li>
        
      
      </ul>
    </div>

  <!-- Footer -->
  </div>
</div>
<footer class="row">
    <div class="large-12 columns">
      <hr />
      <div class="row">
        <div class="large-6 columns">
          <p class="copyright">&copy; relate it maintained by <a href="https://github.com/tootedom">tootedom</a></p>
        </div>
        <div class="large-6 columns">
          <ul class="inline-list right">
            <li><a href="https://github.com/tootedom/related"><i class="fa fa-github"></i> Relate it (Source)</a></li>
            <li><address><a href="mailto:dominic.tootell@relateit.io"><i class="fa fa-envelope"></i> Dominic Tootell</a></address></li>
            <li><a href="https://twitter.com/tootedom"><i class="fa fa-twitter"></i>@tootedom</a></li>
          </ul>
        </div>
      </div>
    </div>
</footer>
<script src="/javascripts/vendor/jquery.js"></script>
<script src="/javascripts/foundation/foundation.js"></script>
<script src="/javascripts/foundation/foundation.dropdown.js"></script>
<script src="/javascripts/foundation/foundation.magellan.js"></script>
<script src="/javascripts/foundation/foundation.offcanvas.js"></script>
<script>
      $(document).foundation({
        // specify the class used for active dropdowns
        active_class: 'open'
      });

      var doc = document.documentElement;
      doc.setAttribute('data-useragent', navigator.userAgent);
</script>

  <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-47714522-1");
            pageTracker._trackPageview();
            } catch(err) {}
</script>
  </body>
</html>

